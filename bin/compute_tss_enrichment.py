#!/usr/bin/env python

import argparse
import numpy as np
import pandas as pd

parser = argparse.ArgumentParser(
    description="Compute TSS enrichment score from plotProfile --outFileNameData output"
)

parser.add_argument(
    "-i", "--input",
    required=True,
    help="signal_coverage.tab file generated by plotProfile"
)

parser.add_argument(
    "-o", "--output",
    required=True,
    help="Output file for TSS enrichment score"
)

args = parser.parse_args()


df = pd.read_csv(args.input, sep="\t", comment="#")

signal = df.iloc[0, 1:].to_numpy()

n = len(signal)


center = signal[n//2 - 2 : n//2 + 2].mean()


flanks = np.concatenate([
    signal[: n // 4],
    signal[3 * n // 4 :]
]).mean()

enrichment = center / flanks


with open(args.output, "w") as f:
    f.write(f"TSS_enrichment\t{enrichment:.5f}\n")

print(f"TSS enrichment score: {enrichment:.5f}")
